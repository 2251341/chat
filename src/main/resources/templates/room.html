<!doctype html>
<html lang="en">
<head>
    <title>Websocket Chat</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <!-- CSS -->
    <link rel="stylesheet" href="/webjars/bootstrap/4.3.1/dist/css/bootstrap.min.css">
    <style>
        [v-cloak] { display: none; }
    </style>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h3>채팅방 리스트</h3>
        </div>
    </div>
    <form id="createRoomForm">
        <div class="input-group">
            <div class="input-group-prepend">
                <label class="input-group-text">방제목</label>
            </div>
            <input type="text" class="form-control" id="room_name" name="roomName" required>
            <div class="input-group-append">
                <button class="btn btn-primary" type="submit">채팅방 개설</button>
            </div>
        </div>
    </form>
    <ul class="list-group" id="chatrooms">
        <!-- List of chat rooms will be populated here -->
    </ul>
</div>
<script>
    document.getElementById('createRoomForm').onsubmit = function(event) {
      event.preventDefault();
      var roomName = document.getElementById('room_name').value;
      if (roomName) {
        // Simple AJAX call to create a room
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/chat/room");
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.onload = function() {
          if (xhr.status === 200) {
            alert('Room created successfully');
            loadRooms(); // Reload rooms list
          } else {
            alert('Error creating room');
          }
        };
        xhr.send('name=' + encodeURIComponent(roomName));
      } else {
        alert('Please enter a room name');
      }
    };

    function loadRooms() {
      var xhr = new XMLHttpRequest();
      xhr.open("GET", "/chat/rooms");
      xhr.onload = function() {
        if (xhr.status === 200) {
          var rooms = JSON.parse(xhr.responseText);
          var roomsList = document.getElementById('chatrooms');
          roomsList.innerHTML = ''; // Clear existing rooms
          rooms.forEach(function(room) {
            var li = document.createElement('li');
            li.className = 'list-group-item list-group-item-action';
            li.textContent = room.name;
            li.onclick = function() {
              window.location.href = '/chat/room/enter/' + room.roomId;
            };
            roomsList.appendChild(li);
          });
        } else {
          alert('Error loading rooms');
        }
      };
      xhr.send();
    }

    loadRooms(); // Initial load of rooms
</script>
</body>
</html>
